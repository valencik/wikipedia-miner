<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Wikipedia Miner - Services</title>
		<link rel="stylesheet" href="css/wikipediaMiner.css" type="text/css">
		<link rel="stylesheet" href="css/tooltips.css" type="text/css">
		<link type="text/css" href="css/custom-theme/jquery-ui-1.8.10.custom.css" rel="stylesheet" />
		
		<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script> 
		<script type="text/javascript" src="js/jquery-ui-1.8.10.custom.min.js"></script>
		<script type="text/javascript" src="js/jquery.qtip-1.0.0-rc3.min.js"></script>
		<script type="text/javascript" src="js/tooltips.js"></script> 
		
		<style>
			
			#serviceList {
				margin-left: 20px ;
				color: rgb(50,50,50) ;
			}
			
			#serviceList td {
				padding-bottom: 5px;
			}
			
			.serviceName {
				text-align: right ;
				font-size: 1.2em ;
				padding-right: 10px ;
			}
		
		
			.paramGroup {
				border-width: 1px ;
				margin: 10px ;
				padding: 10px ;
			}
			
			.paramGroup .title {
				cursor: pointer ;
			}
			
			.paramGroup .title:hover {
				color: #3366bd ;
			}
			
			.paramGroup .title span {
				font-size: 130% ;
				padding-left: 10px ;
			}
			
			.paramGroup .content {

			}
			
			.paramGroup p {
				margin-left: 10px ;
			}
			
			.param {
				margin-left: 10px ;
				margin-right: 10px;
				margin-top: 5px ;
				padding: 10px ;
			}
			
			.param p {
				margin-left: 0px ;
			}
			
			.param .title {
				cursor: pointer ;
			}
			
			.param .title:hover {
				color: #3366bd ;
			}
			
			.param .title span {
				font-size: 120% ;
				padding-left: 10px ;
			}
			
			.param .content {
				display: none ;
				margin-left: 25px ;
			}
			
			.param td {
				vertical-align:middle ;
				padding-top: 6px ;
			}
			
			.param .datatype, .param .value {
				color: #3366bd;
				margin-right:10px ;
				cursor: help;
			}
			
			.param .header {
				text-align: right ;
				font-weight: bold ;
				padding-right: 10px ;
			}

			.example {
				margin-left: 10px ;
				margin-top: 5px ;
				margin-right: 10px ;
				padding: 10px ;
				
				position: relative;
			}
			
			.example a {
				color: #3366bd;
			}
			
			
			.example .title {
				cursor: pointer ;
			}
			
			.example .title:hover {
				color: #3366bd ;
			}
			
			.example .title span {
				font-size: 110% ;
				padding-left: 10px ;
			}
			
			.example .content {
				display: none ;
				padding-left: 20px ;
				
			}
			
			.example .params {
				color: rgb(50,50,50) ;
				font-family: "Courier New", Courier, monospace; 
				padding-left: 10px ;
			}
			
			.example .params .param {

				padding: 0px ;
				margin: 0px ;
				
				margin-left: 30px;
				text-indent: -20px;
			}
			
			.example .try {
				
				position: absolute ;
				bottom: 20px ;
				right: 20px ;
				
				font-size: 110% ;
				
				padding-right: 20px ;
				background-image: url(../images/external.gif) ;
				background-repeat: no-repeat;
				background-position: right -2px ;
			}
			
			
			
			
			
		</style>
		
		<script type="text/javascript">
			
			var datatypeDescriptions = {} ;
			datatypeDescriptions["integer"] = "any whole number" ;
			datatypeDescriptions["float"] = "any whole number or fraction" ;
			datatypeDescriptions["string"] = "a URL-encoded string" ;
			datatypeDescriptions["boolean"] = "<i>true</i> or <i>false</i>. If the name of a boolean parameter is given without a value, then the value is assumed to be true" ;
			datatypeDescriptions["integer list"] = "a list of comma separated integers (e.g. <i>12,14,200</i>)" ;
			datatypeDescriptions["enum"] = "one of a prespecified set of strings" ;
			datatypeDescriptions["enum list"] = "a comma separated set of enums" ;
			
			$.fn.qtip.styles.wmstyle = { // Last part is the name of the style
			   color: 'black',
			   background: '#f1fafc' ,
			   border: {
			   	 width: 5,
		         radius: 10,
				 color: '#bfe2fa'
		       },
               padding: 10, 
               textAlign: 'center',
               tip: true, 
			   name: 'cream' // Inherit the rest of the attributes from the preset dark style
			}
			
			
			$(document).ready(function() {
				//requestServiceList() ;
				
				var location = document.location.toString() ;
				
				if (location.match('\\?')) {
					var serviceName = location.split('?')[1] ;
					requestServiceDetails(serviceName) ;
					
					$("#allServices").hide() ;
					$("#singleService").show() ;
				} else {
					requestServiceList() ;
					$("#allServices").show() ;
					$("#singleService").hide() ;
					
					wm_addDefinitionTooltipsToAllLinks($('#allServices'))
				}
			}) ;
			
			function requestServiceList() {
				$.get("listServices", function(response){
				processServiceListResponse(response);
				});
			}
			
			function processServiceListResponse(response) {
				
				var table = $("#serviceList") ;
				
				var sortedServices = $(response).find("Service").get().sort(function(a,b) {
					var valA = $(a).attr("name") ;
					var valB = $(b).attr("name") ;
					
					return valA < valB ? -1 : valA == valB? 0 : 1 ;
				}) ;
				
				$.each(sortedServices, function(){
					
					var service = $(this) ;
					
					//alert(service.attr("name")) ;
					
					var tr = $("<tr></td>") ;
					table.append(tr) ;
					
					tr.append("<td class='serviceName'><a href='?" + service.attr("name") + "'>" + service.attr("name") + "</a></td>") ;
					tr.append("<td>" + service.find("Details").text() + "</td>") ;
				}) ;
				
			}
			
			function requestServiceDetails(serviceName) {
				$.get(serviceName+"?help", function(xml){
					processServiceDetailsResponse($(xml).find("ServiceDescription"));
				});
			}
			
			function processServiceDetailsResponse(response) {
				
				$("#singleService").append("<h2><em>" + response.attr("serviceName") + "</em> service</h2>") ;
				
				$("#singleService").append($(response).children("Details").text()) ;
				
				$("#singleService").append("<h3>Available parameters</h3>") ;
				
				if ($(response).find("Parameter[name!='help']").length == 0) {
					$("#singleService").append("<p class='explanatory'>There are no parameters to specify</p>") ;
					return ;
				}
				
				var paramGroups = $(response).find("ParameterGroup") ;
				
				if (paramGroups.length > 0) {
					
					$("#singleService").append("<p class='explanatory'>Only specify parameters from <em>one</em> of the following groups</p>") ;
					
					$.each($(response).find("ParameterGroup"), function(){
						$("#singleService").append(constructParamGroupBox($(this))) ;
					}) ;
				}
				
				var mandatoryGlobalParams = $(response).children("Parameter[optional|='false']") ;
				
				if (mandatoryGlobalParams.length > 0) {
					
					if (mandatoryGlobalParams.length == 1)
						$("#singleService").append("<p class='explanatory'>Specify the following</p>") ;
					else
						$("#singleService").append("<p class='explanatory'>Specify <em>all</em> of the following</p>") ;
					
					$.each(mandatoryGlobalParams, function(){
						var xmlParam = $(this) ;
						var divParam = constructParamBox(xmlParam) ;
						$("#singleService").append(divParam);
						intializeParamBox(divParam, xmlParam) ;
					}) ;
				}
				
				
				var optionalGlobalParams = $(response).children("Parameter[optional|='true']") ;
				var baseParams = $(response).children("BaseParameters").children("Parameter[name!='help']") ;
				
				if (optionalGlobalParams.length + baseParams.length > 0) {
					
					if (optionalGlobalParams.length + baseParams.length == 1)
						$("#singleService").append("<p class='explanatory'>Optionally specify the following</p>") ;
					else 
						$("#singleService").append("<p class='explanatory'>Optionally specify <em>any</em> of the following</p>") ;
					
					$.each(optionalGlobalParams, function(){
						var xmlParam = $(this) ;
						var divParam = constructParamBox(xmlParam) ;
						$("#singleService").append(divParam);
						intializeParamBox(divParam, xmlParam) ;
					}) ;
					
					$.each(baseParams, function(){
						var xmlParam = $(this) ;
						var divParam = constructParamBox(xmlParam) ;
						$("#singleService").append(divParam);
						intializeParamBox(divParam, xmlParam) ;
					}) ;
				}
				
				var examples = $(response).children("Examples").children("Example") ;
				
				if (examples.length > 0) {
					$("#singleService").append("<h3>Examples</h3>") ;
					
					$.each(examples , function() {
						$("#singleService").append(constructExampleBox($(this), response.attr("serviceName")));
					}) ;
				}
			}
			
			function constructParamGroupBox(xmlParamGroup) {
				var divParamGroup = $("<div class='paramGroup ui-widget-content ui-corner-all'></div>") ;
				
				var divParamGroupTitle = $("<div class='title'></div>") ;
				divParamGroup.append(divParamGroupTitle) ;
				
				divParamGroupTitle.append("<div style='float:left' class='ui-icon ui-icon-circle-triangle-s'></div>") ;
				divParamGroupTitle.append("<div style='float:left ; display:none ;' class='ui-icon ui-icon-circle-triangle-n'></div>") ;
				
				divParamGroupTitle.bind('click', function() {
					$(this).parent().children('.content').slideToggle('fast')  ;
					$(this).children('.ui-icon').toggle() ;
					return false ;
				}) ;
				
				divParamGroupTitle.bind('mouseover', function(event) {
					$(this).parent().addClass("ui-state-highlight") ;
				}) ;
				
				divParamGroupTitle.bind('mouseout', function(event) {
					$(this).parent().removeClass("ui-state-highlight") ;
				}) ;
				
				divParamGroupTitle.append("<span>" + xmlParamGroup.children("Description").text() + "</span>");
				
				var divParamGroupContent = $("<div class='content' style='display: none'></div>") ;
				divParamGroup.append(divParamGroupContent) ;
				
				var mandatoryParams = xmlParamGroup.children("Parameter[optional|='false']") ;
				
				if (mandatoryParams.length > 0) {
					if (mandatoryParams.length == 1)
						divParamGroupContent.append("<p class='explanatory'>Specify the following</p>");
					else
						divParamGroupContent.append("<p class='explanatory'>Specify <em>all</em> of the following</p>");
					
					$.each(mandatoryParams, function(){
						var xmlParam = $(this) ;
						var divParam = constructParamBox(xmlParam) ;
						divParamGroupContent.append(divParam);
						intializeParamBox(divParam, xmlParam) ;
					});
				}
				
				var optionalParams = xmlParamGroup.children("Parameter[optional|='true']") ;
				
				if (optionalParams.length > 0) {
					if (optionalParams.length == 1)
						divParamGroupContent.append("<p class='explanatory'>Optionally specify the following</p>");
					else
						divParamGroupContent.append("<p class='explanatory'>Optionally specify <em>any</em> of the following</p>");
					
					$.each(optionalParams, function(){
						var xmlParam = $(this) ;
						var divParam = constructParamBox(xmlParam) ;
						divParamGroupContent.append(divParam);
						intializeParamBox(divParam, xmlParam) ;
					});
				}
				
				return divParamGroup ;
			}
			
			function constructParamBox(xmlParam) {
				
				var divParam = $("<div class='param ui-widget-content ui-corner-all'></div>");
				
				var divParamTitle = $("<div class='title' ></div>") ;
				divParam.append(divParamTitle) ;

				
				divParamTitle.append("<div style='float:left' class='ui-icon ui-icon-circle-triangle-s'></div>") ;
				divParamTitle.append("<div style='float:left' class='ui-icon ui-icon-circle-triangle-n'></div>") ;
				
				divParamTitle.bind('click', function(event) {
					$(this).parent().children('.content').slideToggle('fast') ;
					$(this).children('.ui-icon').toggle() ;
					event.stopImmediatePropagation();
				}) ;
				
				
				divParamTitle.bind('mouseover', function(event) {
					$(this).parent().addClass("ui-state-highlight") ;
				}) ;
				
				divParamTitle.bind('mouseout', function(event) {
					$(this).parent().removeClass("ui-state-highlight") ;
				}) ;
				
				
				divParamTitle.append("<span>" + xmlParam.attr("name") + "</span>");
				
				var divParamContent = $("<div class='content'></div>") ;
				divParam.append(divParamContent) ;
				divParamContent.append("<p>" + xmlParam.children("Description").text() + "</p>") ;
				
				var tblType = divParamContent.append("<table></table>") ;
				
				var tr = tblType.append("<tr></tr>") ;
				tr.append("<td class='header'>type</td>") ;
				
				tr.append("<td><a class='datatype'>" + xmlParam.attr("dataType") + "</a></td>") ;
				tr.find(".datatype").qtip(
				   {
				      content: datatypeDescriptions[xmlParam.attr("dataType")],
					  style: {
		                  name: 'wmstyle' 
               		  }
				   }) ;
				
				
				var possibleValues = xmlParam.children("PossibleValue") ;
				
				if (possibleValues.length > 0) {
					
					tr = tblType.append("<tr/>") ;
					
					tr.append("<td class='header'>possible values</td>") ;
					
					var td = $("<td></td>") ;
				
					$.each(possibleValues, function() {
						var xmlPossibleVal = $(this) ;
						
						var val = $("<span class='value'>" + xmlPossibleVal.attr("name") + "</a></span>") ;
						val.qtip(
						   {
						      content: xmlPossibleVal.attr("description"),
							  style: {
				                  name: 'wmstyle' 
		               		  }
						   }) ;
						td.append(val) ;
					}) ;
					
					tr.append(td) ;
				}
				
				
				if (typeof xmlParam.attr('default') != "undefined") {
					tr = tblType.append("<tr></tr>") ;
					
					tr.append("<td class='header'>default value</td>")
					tr.append("<td>" + xmlParam.attr('default') + "</td>");	
					
				}
				return divParam ;
			}
			
			//Decide wheither to initially expand or collapse param box initially
			//Mandatory params are expanded initially, optional ones are collapsed
			function intializeParamBox(divParam, xmlParam) {
				if (typeof xmlParam.attr('default') != "undefined") {
					divParam.find(".content").hide() ;
					divParam.find(".ui-icon-circle-triangle-s").show() ;
					divParam.find(".ui-icon-circle-triangle-n").hide() ;	
				} else {
					divParam.find(".content").show() ;
					divParam.find(".ui-icon-circle-triangle-s").hide() ;
					divParam.find(".ui-icon-circle-triangle-n").show() ;
				}
			}
			
			
			
			function constructExampleBox(xmlExample, serviceName) {
				
				var divExample = $("<div class='example ui-widget-content ui-corner-all'></div>");
				
				var divExampleTitle = $("<div class='title' ></div>") ;
				divExample.append(divExampleTitle) ;
				
				divExampleTitle.append("<div style='float:left' class='ui-icon ui-icon-circle-triangle-s'></div>") ;
				divExampleTitle.append("<div style='float:left; display:none' class='ui-icon ui-icon-circle-triangle-n'></div>") ;
				
				divExampleTitle.bind('click', function(event) {
					$(this).parent().children('.content').slideToggle('fast') ;
					$(this).children('.ui-icon').toggle() ;
				}) ;
				
				divExampleTitle.bind('mouseover', function(event) {
					$(this).parent().addClass("ui-state-highlight") ;
				}) ;
				
				divExampleTitle.bind('mouseout', function(event) {
					$(this).parent().removeClass("ui-state-highlight") ;
				}) ;
				
				divExampleTitle.append("<span class='title'>" + xmlExample.text() + "</span>") ;
				
				var divExampleContent = $("<div class='content'></div>") ;
				divExample.append(divExampleContent) ;
				
				
				
				var parParams = $("<p class='params'>services/" + serviceName + "</p>") ;
				
				divExampleContent.append(parParams) ;
				
				$.each(xmlExample.find("Parameter"), function(index, value) {
					
					var parParam = $("<p class='param'></p>") ;
					parParams.append(parParam) ;
					
					if (index == 0)
						parParam.append("?") ;
					else
						parParam.append("&") ;
						
					if ($(value).attr('value') == 'true')
						parParam.append("<b>" + $(value).attr("name") + "</b>") ;
					else
						parParam.append("<b>" + $(value).attr("name") + "</b>=" + $(value).attr("value")) ;
				});
				
				var cmdTry = $("<a class='try' target='_blank' href='" + xmlExample.attr("url") + "'>try it!</a>") ;
				divExampleContent.append(cmdTry) ;
				
				return divExample ;
			}
			
			
		</script>
		
	</head>
	<body>
		<div id="title">
			
		</div>		
		<div id="content">

			<div id="navigation">
				<a href="http://wikipedia-miner.sf.net/index.htm">Home</a>
				<em>Services</em>
				<a href="http://wikipedia-miner.sf.net/details.htm">Details</a>

				<a href="http://wikipedia-miner.sf.net/publications.htm">Publications</a>
				<a href="http://www.cs.waikato.ac.nz/~dnk2">Contact</a>
			</div>
			
			
			<br/>
			
			
			
			<div id="allServices">
				<p>
					Running Wikipedia Miner locally involves downloading and processing a huge amount of information. 
					We host a suite of xml-based services here at the 
					<a pageId='239210' href='http://www.en.wikipedia.org/wiki/University%20of%20Waikato'>University of Waikato</a> that provide 
					easier access to much of the toolkit's functionality. 
				</p>
				
				<p>
					Click on any of the services listed below to find out more about what they do, and how to use them.
				</p>
				
				<table id="serviceList">
					
				</table>
				
				<p>
					Feel free to call these services directly or from within your own web applications, but bear in mind that 
					we may restrict access if usage becomes excessive. You can always host these same services yourself by installing 
					your own version of Wikipedia Miner (the code to do so is included in the toolkit).
				</p>	
			</div>
			<div id="singleService">
				
			</div>
			
			
			
			<div id="content_tl"></div>
			<div id="content_tr"></div>
			<div id="content_bl"></div>
			<div id="content_br"></div> 
		</div>
		
	</body>
</html>
